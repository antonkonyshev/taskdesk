var M=(n,s)=>()=>(s||n((s={exports:{}}).exports,s),s.exports);var b=(n,s,t)=>new Promise((a,o)=>{var r=y=>{try{v(t.next(y))}catch($){o($)}},c=y=>{try{v(t.throw(y))}catch($){o($)}},v=y=>y.done?a(y.value):Promise.resolve(y.value).then(r,c);v((t=t.apply(n,s)).next())});import{w as D,z as R,A as G,B as E,y as P,C as h,D as u,F as l,G as I,H as f,I as k,J as e,K as z,L as N,M as m,O as L,P as Q,Q as B,v as U}from"../index-DsV9d6SF.js";import{d as H,f as q,r as X,c as Y,p as Z,u as S,m as j,_ as ee,i as te,a as ne}from"../AddButton.vue_vue_type_script_setup_true_lang-ePPDXgOU.js";var et=M(x=>{const A=H("tasks",()=>{const n=D([]),s=w(),{width:t}=R(),a=()=>"/task/",o=p=>X(p,n,g=>p.uuid==g.uuid,!0),r=()=>b(x,null,function*(){return(yield q(a())).forEach(o)});function c(){const p={id:0,uuid:"new",description:"",urgency:100,project:"",tags:[],entry:null,depends:[],blocks:!1,status:"new",annotations:[]};n.value.unshift(p),s.select(p)}function v(p){return b(this,null,function*(){let g=n.value.findIndex(i=>i.uuid==p.uuid);if(g<0&&(g=n.value.findIndex(i=>i.uuid=="new")),g<0)n.value.unshift(p);else for(const i in p){const d=i;n.value[g][d]=p[d]}})}function y(p){for(const g of n.value)if(g.depending&&g.depends.length){const i=g.depends.indexOf(p.uuid);i>=0&&(g.depending=null,g.depends.splice(i,1))}for(const g of p.depends){const i=n.value.find(d=>d.uuid==g);i&&(i.blocking=null)}}function $(p){return b(this,null,function*(){const g=n.value.findIndex(i=>i.uuid==p.uuid);g>=0&&n.value.splice(g,1),s.excludeFromHistory(p),n.value.length&&t.value>=800&&s.select(n.value[0]),y(p)})}function O(p){for(const g of n.value)if(g.depends.indexOf(p.uuid)>=0)return p.blocking=!0,!0;return p.blocking=!1,!1}function F(p){for(const g of p.depends)if(n.value.findIndex(i=>i.uuid==g)>=0)return p.depending=!0,!0;return p.depending=!1,!1}return{tasks:n,loadTasks:r,removeTask:$,createTask:c,refreshTask:v,isTaskBlocking:O,isTaskDepending:F}});let C=null;const se=(n,s)=>b(x,null,function*(){return yield A().refreshTask(JSON.parse(s.data))}),J=n=>b(x,null,function*(){const s="/task/"+n+"/";return C&&!(C.ws.value&&C.ws.value.url==s)&&(yield W(),C=null),C=yield Z(C,s,se),C}),W=()=>Y(C),oe=(n,s)=>new Promise((t,a)=>b(x,null,function*(){try{const o={method:s};s=="post"&&(o.body=JSON.stringify({uuid:n,done:!0}),o.headers={"Content-Type":"application/json"});const r=yield fetch(window.API_BASE_URL+"/task/"+n+"/",o);r.ok?t():a(r.status)}catch(o){a(o)}})),ae=n=>new Promise((s,t)=>b(x,null,function*(){try{(yield J(n.uuid)).send(JSON.stringify(n)),s()}catch(a){t(a)}})),ie=n=>b(x,null,function*(){return new Promise((s,t)=>b(x,null,function*(){try{n.uuid&&n.annotate&&(yield J(n.uuid)).send(JSON.stringify(n)),s()}catch(a){t(a)}}))}),le=n=>b(x,null,function*(){return new Promise((s,t)=>b(x,null,function*(){try{n.uuid&&n.denotate&&(yield J(n.uuid)).send(JSON.stringify(n)),s()}catch(a){t(a)}}))}),w=H("task",()=>{const n=D(null),s=D(""),t=A(),a=G(n,{capacity:64});function o(i){n.value=i}const r=E(()=>{const i=new Set([]);for(const d of n.value.depends){const _=t.tasks.find(T=>T.uuid==d);_&&i.add(_)}return i}),c=E(()=>{const i=new Set([]);if(n.value&&n.value.blocks!==!1)for(const d of t.tasks)d.depends&&d.depends.length&&d.depends.indexOf(n.value.uuid)>=0&&i.add(d);return i});function v(i){return b(this,null,function*(){const d=i.target,_=d.value.trim();if(n.value&&n.value.uuid&&d.name in n.value&&n.value[d.name]!=_&&(d.name!="description"||_)){const T={uuid:n.value.uuid};T[d.name]=_,yield ae(T),n.value[d.name]=_}})}let y=0;function $(i){y&&(clearTimeout(y),y=0),i.target==document.activeElement?y=setTimeout(v,3e3,i):v(i)}function O(i){return b(this,null,function*(){n.value&&n.value.uuid&&(yield oe(n.value.uuid,i),yield t.removeTask(n.value),o(null))})}function F(i){return b(this,null,function*(){const d=i.target;if(d.name=="annotate"){const _=d.value.trim();n.value&&n.value.uuid&&_&&(yield ie({uuid:n.value.uuid,annotate:_}),n.value.annotations.unshift({entry:new Date,description:_}))}})}function p(i){return b(this,null,function*(){i&&n.value&&n.value.uuid&&(yield le({uuid:n.value.uuid,denotate:i}),n.value.annotations=n.value.annotations.filter(d=>d.description.indexOf(i)<0))})}function g(i){for(const d of["history","undoStack","redoStack"]){let _=a[d].value.findIndex(T=>T.snapshot&&T.snapshot.uuid==i.uuid);i.id==2&&_>=0&&_>=0&&a[d].value.splice(_,1)}}return P(n,(i,d)=>b(x,null,function*(){d&&d.uuid=="new"&&t.removeTask(d),(!i||!d||d.uuid!=i.uuid)&&(yield W())})),P(()=>n.value&&n.value.uuid,(i,d)=>{d=="new"&&i&&i!="new"&&(s.value="message.task_created",setTimeout(()=>s.value="",2e3))}),{task:n,history:a,depends:r,blocks:c,select:o,editing:$,update:O,annotate:F,denotate:p,excludeFromHistory:g,notification:s}}),K=h({__name:"StateLabels",props:{task:{},labelClass:{},commonLabelClass:{},criticalLabelClass:{},shortenLabels:{},allowRowArrangement:{}},setup(n){const{t:s}=S(),{width:t}=R(),a=A();return(o,r)=>(l(),u("span",{class:I(["flex flex-col",{"flex-row xl:flex-col":o.allowRowArrangement}])},[o.task.wait?(l(),u("span",{key:0,class:I([o.labelClass+" "+o.commonLabelClass,"task-label"])},k(o.shortenLabels&&e(t)<+o.shortenLabels?e(s)("message.delayed"):e(s)("message.delayed_task")),3)):f("",!0),o.task.depending===!0||e(a).isTaskDepending(o.task)?(l(),u("span",{key:1,class:I([o.labelClass+" "+o.commonLabelClass,"task-label"])},k(o.shortenLabels&&e(t)<+o.shortenLabels?e(s)("message.blocked"):e(s)("message.blocked_task")),3)):f("",!0),o.task.blocking===!0||e(a).isTaskBlocking(o.task)?(l(),u("span",{key:2,class:I([o.labelClass+" "+o.criticalLabelClass,"task-label"])},k(o.shortenLabels&&e(t)<+o.shortenLabels?e(s)("message.blocking"):e(s)("message.blocking_tasks")),3)):f("",!0)],2))}}),re={class:"flex-1 overflow-y-scroll scroll-smooth overflow-x-clip [overflow-clip-margin:10px] max-h-[calc(100vh_+_0.75rem)] md:-ml-6 md:pl-6"},ue=["onClick"],ce={class:"font-semibold flex flex-row justify-between items-start gap-2"},de=["textContent"],pe={key:0,class:"flex flex-row flex-wrap gap-2 py-1"},fe=["textContent"],ke=["textContent"],ge={key:1,class:"flex flex-row gap-1 items-center"},me=["textContent"],be=["textContent"],_e=h({__name:"TasksList",setup(n){const{t:s}=S(),t=w(),a=A();return(o,r)=>(l(),u("div",re,[(l(!0),u(z,null,N(e(a).tasks,c=>(l(),u("div",{key:c.uuid,onClick:v=>e(t).select(c),class:I([{"!shadow-lg !scale-[102%]":e(t).task&&c.uuid===e(t).task.uuid},"my-3 p-3 md:mx-4 shadow-black shadow-xs bg-white hover:shadow-md hover:scale-[101%] dark:bg-gray-800 dark:text-white duration-200 cursor-pointer wrap-break-word"])},[m("h2",ce,[m("span",{textContent:k(c.description),class:I(["text-lg flex-1",{"text-gray-600":c.depending===!0||e(a).isTaskDepending(c)||c.wait}])},null,10,de),L(K,{task:c,class:"gap-1","label-class":"text-xs","common-label-class":"bg-gray-200 dark:bg-gray-700","critical-label-class":"bg-red-700 text-white","shorten-labels":"400"},null,8,["task"])]),c.tags?(l(),u("ul",pe,[(l(!0),u(z,null,N(c.tags,v=>(l(),u("li",{textContent:k(v),class:"bg-gray-200 dark:bg-gray-700 text-xs task-label"},null,8,fe))),256)),!c.due&&c.project?(l(),u("li",{key:0,textContent:k(c.project),class:"bg-gray-200 text-xs task-label ml-auto"},null,8,ke)):f("",!0)])):f("",!0),c.due?(l(),u("p",ge,[m("span",{textContent:k(c.due?e(s)("message.due_date")+" "+e(j)(c.due).fromNow():""),class:"flex-1"},null,8,me),c.project?(l(),u("span",{key:0,textContent:k(c.project),class:"bg-gray-200 dark:bg-gray-700 text-xs task-label !pb-1"},null,8,be)):f("",!0)])):f("",!0)],10,ue))),128))]))}}),ye={class:"flex flex-row flex-nowrap gap-3"},ve=h({__name:"Actions",setup(n){const s=w();return(t,a)=>(l(),u("aside",ye,[e(s).history.canUndo?(l(),u("button",{key:0,type:"button",onClick:a[0]||(a[0]=o=>e(s).history.undo()),class:"action-button hover:bg-gray-300"},a[4]||(a[4]=[m("span",{class:"inline-block size-6 bg-no-repeat bg-center bg-contain svg-arrow-left dark:invert-100 dark:hover:invert-0"},null,-1)]))):f("",!0),e(s).history.canRedo?(l(),u("button",{key:1,type:"button",onClick:a[1]||(a[1]=o=>e(s).history.redo()),class:"action-button hover:bg-gray-300"},a[5]||(a[5]=[m("span",{class:"inline-block size-6 bg-no-repeat bg-center bg-contain svg-arrow-right dark:invert-100 dark:hover:invert-0"},null,-1)]))):f("",!0),e(s).task.uuid!="new"?(l(),u("button",{key:2,type:"button",onClick:a[2]||(a[2]=o=>e(s).update("delete")),class:"action-button hover:bg-red-700 hover:!border-red-700 group ml-auto"},a[6]||(a[6]=[m("span",{class:"inline-block size-6 bg-no-repeat bg-center bg-contain svg-trash dark:invert-100 group-hover:invert-100"},null,-1)]))):f("",!0),e(s).task.uuid!="new"?(l(),u("button",{key:3,type:"button",onClick:a[3]||(a[3]=o=>e(s).update("post")),class:"action-button hover:bg-green-700 hover:!border-green-700 group"},a[7]||(a[7]=[m("span",{class:"inline-block size-6 bg-no-repeat bg-center bg-contain svg-check dark:invert-100 group-hover:invert-100"},null,-1)]))):f("",!0)]))}}),xe={key:0},he=["textContent"],we=["textContent","onClick"],Ce=h({__name:"Dependencies",setup(n){const{t:s}=S(),t=w();return(a,o)=>e(t).depends.size?(l(),u("p",xe,[m("span",{textContent:k(e(s)("message.this_task_depends_on_the_following_tasks")+":"),class:"font-semibold"},null,8,he),(l(!0),u(z,null,N(e(t).depends,r=>(l(),u("a",{href:"#",textContent:k(r.description),onClick:c=>e(t).select(r),class:"block underline hover:text-green-700 hover:no-underline duration-200 py-0.5"},null,8,we))),256))])):f("",!0)}}),$e={key:0},Te=["textContent"],Se=["textContent","onClick"],Le=h({__name:"BlockedTasks",setup(n){const{t:s}=S(),t=w();return(a,o)=>e(t).blocks.size?(l(),u("p",$e,[m("span",{textContent:k(e(s)("message.this_task_blocks_the_following_tasks")+":"),class:"font-semibold"},null,8,Te),(l(!0),u(z,null,N(e(t).blocks,r=>(l(),u("a",{href:"#",textContent:k(r.description),onClick:c=>e(t).select(r),class:"block underline hover:text-green-700 hover:no-underline duration-200 py-0.5"},null,8,Se))),256))])):f("",!0)}}),Ie=["textContent"],ze={class:"flex flex-row pt-1 gap-2 items-center"},Ne=["textContent"],je=["textContent"],Ae=["onClick"],Be=["textContent"],De=["placeholder"],Oe=h({__name:"Annotations",setup(n){const{t:s}=S(),t=w(),a=D(!1);return(o,r)=>(l(),u("p",null,[m("span",{textContent:k(e(s)("message.annotations")),class:"font-semibold"},null,8,Ie),(l(!0),u(z,null,N(e(t).task.annotations,c=>(l(),u("span",ze,[m("span",{textContent:k(c.description),class:"flex-1"},null,8,Ne),m("span",{textContent:k(e(j)(c.entry).fromNow())},null,8,je),m("button",{type:"button",onClick:v=>e(t).denotate(c.description),class:"group cursor-pointer action-button !px-1 !py-0.5 mt-0.5 !rounded-md hover:bg-red-700 hover:!border-red-700 duration-200"},r[3]||(r[3]=[m("span",{class:"inline-block size-4 bg-no-repeat bg-center bg-contain svg-trash dark:invert-100 group-hover:invert-100"},null,-1)]),8,Ae)]))),256)),a.value?f("",!0):(l(),u("button",{key:0,type:"button",onClick:r[0]||(r[0]=c=>a.value=!0),class:"flex flex-row items-center gap-1 mt-1 hover:underline cursor-pointer"},[r[4]||(r[4]=m("span",{class:"inline-block size-5 bg-no-repeat bg-center bg-contain svg-plus-circle dark:invert-100 mt-0.5"},null,-1)),m("span",{textContent:k(e(s)("message.add_annotation"))},null,8,Be)])),a.value?(l(),u("input",{key:1,type:"text",placeholder:e(s)("message.enter_annotation_description"),name:"annotate",class:"w-full mt-1",onFocusout:r[1]||(r[1]=c=>{e(t).annotate(c),a.value=!1}),onKeypress:r[2]||(r[2]=Q(c=>{e(t).annotate(c),a.value=!1},["enter"]))},null,40,De)):f("",!0)]))}}),Fe={key:0,class:"flex flex-col items-start"},Pe={key:0,class:"flex flex-col items-start justify-between w-full lg:flex-row lg:items-center"},Re={key:0},Je={key:1},Ee={key:1},Ve=h({__name:"DatesDetails",setup(n){const{t:s}=S(),t=w();return(a,o)=>e(t).task.entry||e(t).task.due||e(t).task.wait?(l(),u("p",Fe,[e(t).task.entry||e(t).task.due?(l(),u("span",Pe,[e(t).task.due?(l(),u("span",Re,k(e(s)("message.due_date"))+" "+k(e(j)(e(t).task.due).fromNow()),1)):f("",!0),e(t).task.entry?(l(),u("span",Je,k(e(s)("message.created"))+" "+k(e(j)(e(t).task.entry).fromNow()),1)):f("",!0)])):f("",!0),e(t).task.wait?(l(),u("span",Ee,k(e(s)("message.will_become_active"))+" "+k(e(j)(e(t).task.wait).fromNow()),1)):f("",!0)])):f("",!0)}}),He={class:"flex-1 relative lg:flex-2 my-3 mx-3 md:!ml-0 px-4 py-3.5 bg-white min-h-screen shadow-[0px_0px_5px_-2px_#000] dark:bg-gray-800 dark:text-white"},We={class:"font-semibold text-2xl flex flex-col xl:flex-row gap-2 items-start xl:items-center pt-4 pb-3"},Ke=["placeholder","value"],Me={key:0,class:"flex flex-row items-center gap-2"},Ge=["textContent"],Qe=["placeholder","value"],Ue=["textContent"],qe=["textContent"],Xe=h({__name:"TaskDetails",setup(n){const{t:s}=S(),t=w();return(a,o)=>(l(),u("div",He,[L(ve),m("h2",We,[m("input",{type:"text",class:"flex-1 w-full outline-none focus-visible:!outline-none",name:"description",id:"id_description",onFocusout:o[0]||(o[0]=(...r)=>e(t).editing&&e(t).editing(...r)),onFocusin:o[1]||(o[1]=(...r)=>e(t).editing&&e(t).editing(...r)),onInput:o[2]||(o[2]=(...r)=>e(t).editing&&e(t).editing(...r)),placeholder:e(s)("message.enter_task_description"),value:e(t).task.description},null,40,Ke),L(K,{task:e(t).task,class:"gap-2","label-class":"text-lg","common-label-class":"bg-gray-200 dark:bg-gray-700","critical-label-class":"bg-red-200 dark:text-black","allow-row-arrangement":"true"},null,8,["task"])]),e(t).task.uuid!="new"?(l(),u("p",Me,[m("span",{textContent:k(e(s)("message.project")+":")},null,8,Ge),m("input",{type:"text",class:"flex-1 outline-none focus-visible:!outline-none",name:"project",placeholder:e(s)("message.not_specified").toLowerCase(),onFocusout:o[3]||(o[3]=(...r)=>e(t).editing&&e(t).editing(...r)),onFocusin:o[4]||(o[4]=(...r)=>e(t).editing&&e(t).editing(...r)),onInput:o[5]||(o[5]=(...r)=>e(t).editing&&e(t).editing(...r)),value:e(t).task.project},null,40,Qe),e(t).task.tags?(l(!0),u(z,{key:0},N(e(t).task.tags,r=>(l(),u("span",{textContent:k(r),class:"bg-gray-200 task-label !pt-0 dark:bg-gray-700"},null,8,Ue))),256)):f("",!0)])):f("",!0),L(Ve),L(Ce,{class:"pt-4"}),L(Le,{class:"pt-4"}),e(t).task.uuid!="new"?(l(),B(Oe,{key:1,class:"pt-4"})):f("",!0),e(t).notification?(l(),u("p",{key:2,class:"fixed bottom-4 right-4 py-4 px-8 rounded-md text-xl font-semibold border-b border-gray-800 shadow-sm shadow-td-gray-dark bg-td-secondary-light dark:bg-td-primary",textContent:k(e(s)(e(t).notification))},null,8,qe)):f("",!0)]))}}),Ye={class:"flex flex-row"},V=768,Ze=h({__name:"TasksApp",setup(n){const s=w(),t=A(),{width:a}=R();function o(){a.value>=V&&!s.task&&t.tasks.length&&s.select(t.tasks[0])}P(a,o);function r(){return b(this,null,function*(){yield t.loadTasks(),o()})}return r(),(c,v)=>(l(),u("div",Ye,[(!e(s).task||e(a)>=V)&&e(t).tasks.length?(l(),B(_e,{key:0})):f("",!0),e(s).task?(l(),B(Xe,{key:1})):f("",!0),(!e(s).task||e(s).task.uuid!="new")&&!e(s).notification?(l(),B(ee,{key:2,"add-item":e(t).createTask},null,8,["add-item"])):f("",!0)]))}});document.getElementById("tasks-app")&&U(Ze).use(te).use(ne()).mount("#tasks-app")});export default et();
