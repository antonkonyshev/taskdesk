var Q=(s,n)=>()=>(n||s((n={exports:{}}).exports,n),n.exports);var _=(s,n,t)=>new Promise((o,l)=>{var c=y=>{try{p(t.next(y))}catch($){l($)}},a=y=>{try{p(t.throw(y))}catch($){l($)}},p=y=>y.done?o(y.value):Promise.resolve(y.value).then(c,a);p((t=t.apply(s,n)).next())});import{w as A,z as P,A as q,B as E,y as H,C as x,D as u,F as r,G as I,H as k,I as g,J as e,K as N,L as z,M as b,O as L,P as U,Q as X,R as D,v as Y}from"../index-CkhJNqIu.js";import{d as V,f as Z,r as ee,c as te,p as se,u as S,m as j,a as ne,_ as oe,b as ae,e as ie,i as le,g as re}from"../AddButton.vue_vue_type_script_setup_true_lang-DHlliibc.js";var it=Q(h=>{const B=V("tasks",()=>{const s=A([]),n=w(),{width:t}=P(),o=()=>"/task/",l=f=>ee(f,s,m=>f.uuid==m.uuid,!0),c=()=>_(h,null,function*(){return(yield Z(o())).forEach(l)});function a(){const f={id:0,uuid:"new",description:"",urgency:100,project:"",tags:[],entry:null,depends:[],blocks:!1,status:"new",annotations:[]};s.value.unshift(f),n.select(f)}function p(f){return _(this,null,function*(){let m=s.value.findIndex(i=>i.uuid==f.uuid);if(m<0&&(m=s.value.findIndex(i=>i.uuid=="new")),m<0)s.value.unshift(f);else for(const i in f){const d=i;s.value[m][d]=f[d]}})}function y(f){for(const m of s.value)if(m.depending&&m.depends.length){const i=m.depends.indexOf(f.uuid);i>=0&&(m.depending=null,m.depends.splice(i,1))}for(const m of f.depends){const i=s.value.find(d=>d.uuid==m);i&&(i.blocking=null)}}function $(f){return _(this,null,function*(){const m=s.value.findIndex(i=>i.uuid==f.uuid);m>=0&&s.value.splice(m,1),n.excludeFromHistory(f),s.value.length&&t.value>=800&&n.select(s.value[0]),y(f)})}function O(f){for(const m of s.value)if(m.depends.indexOf(f.uuid)>=0)return f.blocking=!0,!0;return f.blocking=!1,!1}function F(f){for(const m of f.depends)if(s.value.findIndex(i=>i.uuid==m)>=0)return f.depending=!0,!0;return f.depending=!1,!1}return{tasks:s,loadTasks:c,removeTask:$,createTask:a,refreshTask:p,isTaskBlocking:O,isTaskDepending:F}});let C=null;const ue=(s,n)=>_(h,null,function*(){return yield B().refreshTask(JSON.parse(n.data))}),J=s=>_(h,null,function*(){const n="/task/"+s+"/";return C&&!(C.ws.value&&C.ws.value.url==n)&&(yield K(),C=null),C=yield se(C,n,ue),C}),K=()=>te(C),ce=(s,n)=>new Promise((t,o)=>_(h,null,function*(){try{const l={method:n};n=="post"&&(l.body=JSON.stringify({uuid:s,done:!0}),l.headers={"Content-Type":"application/json"});const c=yield fetch(window.API_BASE_URL+"/task/"+s+"/",l);c.ok?t():o(c.status)}catch(l){o(l)}})),de=s=>new Promise((n,t)=>_(h,null,function*(){try{(yield J(s.uuid)).send(JSON.stringify(s)),n()}catch(o){t(o)}})),pe=s=>_(h,null,function*(){return new Promise((n,t)=>_(h,null,function*(){try{s.uuid&&s.annotate&&(yield J(s.uuid)).send(JSON.stringify(s)),n()}catch(o){t(o)}}))}),fe=s=>_(h,null,function*(){return new Promise((n,t)=>_(h,null,function*(){try{s.uuid&&s.denotate&&(yield J(s.uuid)).send(JSON.stringify(s)),n()}catch(o){t(o)}}))}),w=V("task",()=>{const s=A(null),n=A(""),t=B(),o=q(s,{capacity:64});function l(i){G.push(i?{name:"edit",params:{uuid:i.uuid}}:{name:"list"}),s.value=i}const c=E(()=>{const i=new Set([]);for(const d of s.value.depends){const v=t.tasks.find(T=>T.uuid==d);v&&i.add(v)}return i}),a=E(()=>{const i=new Set([]);if(s.value&&s.value.blocks!==!1)for(const d of t.tasks)d.depends&&d.depends.length&&d.depends.indexOf(s.value.uuid)>=0&&i.add(d);return i});function p(i){return _(this,null,function*(){const d=i.target,v=d.value.trim();if(s.value&&s.value.uuid&&d.name in s.value&&s.value[d.name]!=v&&(d.name!="description"||v)){const T={uuid:s.value.uuid};T[d.name]=v,yield de(T),s.value[d.name]=v}})}let y=0;function $(i){y&&(clearTimeout(y),y=0),i.target==document.activeElement?y=setTimeout(p,3e3,i):p(i)}function O(i){return _(this,null,function*(){s.value&&s.value.uuid&&(yield ce(s.value.uuid,i),yield t.removeTask(s.value),l(null))})}function F(i){return _(this,null,function*(){const d=i.target;if(d.name=="annotate"){const v=d.value.trim();s.value&&s.value.uuid&&v&&(yield pe({uuid:s.value.uuid,annotate:v}),s.value.annotations.unshift({entry:new Date,description:v}))}})}function f(i){return _(this,null,function*(){i&&s.value&&s.value.uuid&&(yield fe({uuid:s.value.uuid,denotate:i}),s.value.annotations=s.value.annotations.filter(d=>d.description.indexOf(i)<0))})}function m(i){for(const d of["history","undoStack","redoStack"]){let v=o[d].value.findIndex(T=>T.snapshot&&T.snapshot.uuid==i.uuid);i.id==2&&v>=0&&v>=0&&o[d].value.splice(v,1)}}return H(s,(i,d)=>_(h,null,function*(){d&&d.uuid=="new"&&t.removeTask(d),(!i||!d||d.uuid!=i.uuid)&&(yield K())})),H(()=>s.value&&s.value.uuid,(i,d)=>{d!="new"||!i||i&&i!="new"&&(n.value="message.task_created",setTimeout(()=>n.value="",2e3))}),{task:s,history:o,depends:c,blocks:a,select:l,editing:$,update:O,annotate:F,denotate:f,excludeFromHistory:m,notification:n}}),M=x({__name:"StateLabels",props:{task:{},labelClass:{},commonLabelClass:{},criticalLabelClass:{},shortenLabels:{},allowRowArrangement:{}},setup(s){const{t:n}=S(),{width:t}=P(),o=B();return(l,c)=>(r(),u("span",{class:I(["flex flex-col",{"flex-row xl:flex-col":l.allowRowArrangement}])},[l.task.wait?(r(),u("span",{key:0,class:I([l.labelClass+" "+l.commonLabelClass,"task-label"])},g(l.shortenLabels&&e(t)<+l.shortenLabels?e(n)("message.delayed"):e(n)("message.delayed_task")),3)):k("",!0),l.task.depending===!0||e(o).isTaskDepending(l.task)?(r(),u("span",{key:1,class:I([l.labelClass+" "+l.commonLabelClass,"task-label"])},g(l.shortenLabels&&e(t)<+l.shortenLabels?e(n)("message.blocked"):e(n)("message.blocked_task")),3)):k("",!0),l.task.blocking===!0||e(o).isTaskBlocking(l.task)?(r(),u("span",{key:2,class:I([l.labelClass+" "+l.criticalLabelClass,"task-label"])},g(l.shortenLabels&&e(t)<+l.shortenLabels?e(n)("message.blocking"):e(n)("message.blocking_tasks")),3)):k("",!0)],2))}}),ke={class:"flex-1 overflow-y-scroll scroll-smooth overflow-x-clip [overflow-clip-margin:10px] max-h-[calc(100vh_+_0.75rem)] md:-ml-6 md:pl-6"},ge=["onClick"],me={class:"font-semibold flex flex-row justify-between items-start gap-2"},be=["textContent"],_e={key:0,class:"flex flex-row flex-wrap gap-2 py-1"},ve=["textContent"],ye=["textContent"],he={key:1,class:"flex flex-row gap-1 items-center"},xe=["textContent"],we=["textContent"],Ce=x({__name:"TasksList",setup(s){const{t:n}=S(),t=w(),o=B();return(l,c)=>(r(),u("div",ke,[(r(!0),u(N,null,z(e(o).tasks,a=>(r(),u("div",{key:a.uuid,onClick:p=>e(t).select(a),class:I([{"!shadow-lg !scale-[102%]":e(t).task&&a.uuid===e(t).task.uuid},"my-3 p-3 md:mx-4 shadow-black shadow-xs bg-white hover:shadow-md hover:scale-[101%] dark:bg-gray-800 dark:text-white duration-200 cursor-pointer wrap-break-word"])},[b("h2",me,[b("span",{textContent:g(a.description),class:I(["text-lg flex-1",{"text-gray-600":a.depending===!0||e(o).isTaskDepending(a)||a.wait}])},null,10,be),L(M,{task:a,class:"gap-1","label-class":"text-xs","common-label-class":"bg-gray-200 dark:bg-gray-700","critical-label-class":"bg-red-700 text-white","shorten-labels":"400"},null,8,["task"])]),a.tags?(r(),u("ul",_e,[(r(!0),u(N,null,z(a.tags,p=>(r(),u("li",{textContent:g(p),class:"bg-gray-200 dark:bg-gray-700 text-xs task-label"},null,8,ve))),256)),!a.due&&a.project?(r(),u("li",{key:0,textContent:g(a.project),class:"bg-gray-200 text-xs task-label ml-auto"},null,8,ye)):k("",!0)])):k("",!0),a.due?(r(),u("p",he,[b("span",{textContent:g(a.due?e(n)("message.due_date")+" "+e(j)(a.due).fromNow():""),class:"flex-1"},null,8,xe),a.project?(r(),u("span",{key:0,textContent:g(a.project),class:"bg-gray-200 dark:bg-gray-700 text-xs task-label !pb-1"},null,8,we)):k("",!0)])):k("",!0)],10,ge))),128))]))}}),$e={class:"flex flex-row flex-nowrap gap-3"},Te=x({__name:"Actions",setup(s){const n=w();return(t,o)=>(r(),u("aside",$e,[e(n).history.canUndo?(r(),u("button",{key:0,type:"button",onClick:o[0]||(o[0]=l=>e(n).history.undo()),class:"action-button hover:bg-gray-300"},o[4]||(o[4]=[b("span",{class:"inline-block size-6 bg-no-repeat bg-center bg-contain svg-arrow-left dark:invert-100 dark:hover:invert-0"},null,-1)]))):k("",!0),e(n).history.canRedo?(r(),u("button",{key:1,type:"button",onClick:o[1]||(o[1]=l=>e(n).history.redo()),class:"action-button hover:bg-gray-300"},o[5]||(o[5]=[b("span",{class:"inline-block size-6 bg-no-repeat bg-center bg-contain svg-arrow-right dark:invert-100 dark:hover:invert-0"},null,-1)]))):k("",!0),e(n).task.uuid!="new"?(r(),u("button",{key:2,type:"button",onClick:o[2]||(o[2]=l=>e(n).update("delete")),class:"action-button hover:bg-red-700 hover:!border-red-700 group ml-auto"},o[6]||(o[6]=[b("span",{class:"inline-block size-6 bg-no-repeat bg-center bg-contain svg-trash dark:invert-100 group-hover:invert-100"},null,-1)]))):k("",!0),e(n).task.uuid!="new"?(r(),u("button",{key:3,type:"button",onClick:o[3]||(o[3]=l=>e(n).update("post")),class:"action-button hover:bg-green-700 hover:!border-green-700 group"},o[7]||(o[7]=[b("span",{class:"inline-block size-6 bg-no-repeat bg-center bg-contain svg-check dark:invert-100 group-hover:invert-100"},null,-1)]))):k("",!0)]))}}),Se={key:0},Le=["textContent"],Ie=["textContent","onClick"],Ne=x({__name:"Dependencies",setup(s){const{t:n}=S(),t=w();return(o,l)=>e(t).depends.size?(r(),u("p",Se,[b("span",{textContent:g(e(n)("message.this_task_depends_on_the_following_tasks")+":"),class:"font-semibold"},null,8,Le),(r(!0),u(N,null,z(e(t).depends,c=>(r(),u("a",{href:"#",textContent:g(c.description),onClick:a=>e(t).select(c),class:"block underline hover:text-green-700 hover:no-underline duration-200 py-0.5"},null,8,Ie))),256))])):k("",!0)}}),ze={key:0},je=["textContent"],Ae=["textContent","onClick"],Be=x({__name:"BlockedTasks",setup(s){const{t:n}=S(),t=w();return(o,l)=>e(t).blocks.size?(r(),u("p",ze,[b("span",{textContent:g(e(n)("message.this_task_blocks_the_following_tasks")+":"),class:"font-semibold"},null,8,je),(r(!0),u(N,null,z(e(t).blocks,c=>(r(),u("a",{href:"#",textContent:g(c.description),onClick:a=>e(t).select(c),class:"block underline hover:text-green-700 hover:no-underline duration-200 py-0.5"},null,8,Ae))),256))])):k("",!0)}}),De=["textContent"],Oe={class:"flex flex-row pt-1 gap-2 items-center"},Fe=["textContent"],Re=["textContent"],Pe=["onClick"],Je=["textContent"],Ee=["placeholder"],He=x({__name:"Annotations",setup(s){const{t:n}=S(),t=w(),o=A(!1);return(l,c)=>(r(),u("p",null,[b("span",{textContent:g(e(n)("message.annotations")),class:"font-semibold"},null,8,De),(r(!0),u(N,null,z(e(t).task.annotations,a=>(r(),u("span",Oe,[b("span",{textContent:g(a.description),class:"flex-1"},null,8,Fe),b("span",{textContent:g(e(j)(a.entry).fromNow())},null,8,Re),b("button",{type:"button",onClick:p=>e(t).denotate(a.description),class:"group cursor-pointer action-button !px-1 !py-0.5 mt-0.5 !rounded-md hover:bg-red-700 hover:!border-red-700 duration-200"},c[3]||(c[3]=[b("span",{class:"inline-block size-4 bg-no-repeat bg-center bg-contain svg-trash dark:invert-100 group-hover:invert-100"},null,-1)]),8,Pe)]))),256)),o.value?k("",!0):(r(),u("button",{key:0,type:"button",onClick:c[0]||(c[0]=a=>o.value=!0),class:"flex flex-row items-center gap-1 mt-1 hover:underline cursor-pointer"},[c[4]||(c[4]=b("span",{class:"inline-block size-5 bg-no-repeat bg-center bg-contain svg-plus-circle dark:invert-100 mt-0.5"},null,-1)),b("span",{textContent:g(e(n)("message.add_annotation"))},null,8,Je)])),o.value?(r(),u("input",{key:1,type:"text",placeholder:e(n)("message.enter_annotation_description"),name:"annotate",class:"w-full mt-1",onFocusout:c[1]||(c[1]=a=>{e(t).annotate(a),o.value=!1}),onKeypress:c[2]||(c[2]=U(a=>{e(t).annotate(a),o.value=!1},["enter"]))},null,40,Ee)):k("",!0)]))}}),We={key:0,class:"flex flex-col items-start"},Ve={key:0,class:"flex flex-col items-start justify-between w-full lg:flex-row lg:items-center"},Ke={key:0},Me={key:1},Ge={key:1},Qe=x({__name:"DatesDetails",setup(s){const{t:n}=S(),t=w();return(o,l)=>e(t).task.entry||e(t).task.due||e(t).task.wait?(r(),u("p",We,[e(t).task.entry||e(t).task.due?(r(),u("span",Ve,[e(t).task.due?(r(),u("span",Ke,g(e(n)("message.due_date"))+" "+g(e(j)(e(t).task.due).fromNow()),1)):k("",!0),e(t).task.entry?(r(),u("span",Me,g(e(n)("message.created"))+" "+g(e(j)(e(t).task.entry).fromNow()),1)):k("",!0)])):k("",!0),e(t).task.wait?(r(),u("span",Ge,g(e(n)("message.will_become_active"))+" "+g(e(j)(e(t).task.wait).fromNow()),1)):k("",!0)])):k("",!0)}}),qe={class:"flex-1 relative lg:flex-2 my-3 mx-3 md:!ml-0 px-4 py-3.5 bg-white min-h-screen shadow-[0px_0px_5px_-2px_#000] dark:bg-gray-800 dark:text-white"},Ue={class:"font-semibold text-2xl flex flex-col xl:flex-row gap-2 items-start xl:items-center pt-4 pb-3"},Xe=["placeholder","value"],Ye={key:0,class:"flex flex-row items-center gap-2"},Ze=["textContent"],et=["placeholder","value"],tt=["textContent"],st=["textContent"],nt=x({__name:"TaskDetails",setup(s){const{t:n}=S(),t=w(),o=A(null);X(()=>{o.value&&!o.value.value&&o.value.focus()});const l=c=>{c.target.value=c.target.value.toLowerCase(),t.editing(c)};return(c,a)=>(r(),u("div",qe,[L(Te),b("h2",Ue,[b("textarea",{class:"flex-1 w-full outline-none focus-visible:!outline-none",type:"text",name:"description",ref_key:"descriptionInput",ref:o,id:"id_description",onFocusout:a[0]||(a[0]=(...p)=>e(t).editing&&e(t).editing(...p)),onFocusin:a[1]||(a[1]=(...p)=>e(t).editing&&e(t).editing(...p)),onInput:a[2]||(a[2]=(...p)=>e(t).editing&&e(t).editing(...p)),placeholder:e(n)("message.enter_task_description"),value:e(t).task.description},null,40,Xe),L(M,{task:e(t).task,class:"gap-2","label-class":"text-lg","common-label-class":"bg-gray-200 dark:bg-gray-700","critical-label-class":"bg-red-200 dark:text-black","allow-row-arrangement":"true"},null,8,["task"])]),e(t).task.uuid!="new"?(r(),u("p",Ye,[b("span",{textContent:g(e(n)("message.project")+":")},null,8,Ze),b("input",{type:"text",class:"flex-1 outline-none focus-visible:!outline-none",name:"project",placeholder:e(n)("message.not_specified").toLowerCase(),onFocusout:a[3]||(a[3]=(...p)=>e(t).editing&&e(t).editing(...p)),onFocusin:a[4]||(a[4]=(...p)=>e(t).editing&&e(t).editing(...p)),onInput:l,value:e(t).task.project},null,40,et),e(t).task.tags?(r(!0),u(N,{key:0},z(e(t).task.tags,p=>(r(),u("span",{textContent:g(p),class:"bg-gray-200 task-label !pt-0 dark:bg-gray-700"},null,8,tt))),256)):k("",!0)])):k("",!0),L(Qe),L(Ne,{class:"pt-4"}),L(Be,{class:"pt-4"}),e(t).task.uuid!="new"?(r(),D(He,{key:1,class:"pt-4"})):k("",!0),e(t).notification?(r(),u("p",{key:2,class:"fixed bottom-4 right-4 py-4 px-8 rounded-md text-xl font-semibold border-b border-gray-800 shadow-sm shadow-td-gray-dark bg-td-secondary-light dark:bg-td-primary",textContent:g(e(n)(e(t).notification))},null,8,st)):k("",!0)]))}}),ot={class:"flex flex-row"},W=768,R=x({__name:"TasksApp",setup(s){const n=ne(),t=w(),o=B(),{width:l}=P();function c(){return _(this,null,function*(){if(yield o.loadTasks(),n.params.uuid=="new")o.createTask();else{let a=-1;n.params.uuid&&(a=o.tasks.findIndex(p=>p.uuid==n.params.uuid)),a<0&&!t.task&&l.value>=W&&o.tasks.length&&(a=0),a>=0&&t.select(o.tasks[a])}})}return c(),(a,p)=>(r(),u("div",ot,[(!e(t).task||e(l)>=W)&&e(o).tasks.length?(r(),D(Ce,{key:0})):k("",!0),e(t).task?(r(),D(nt,{key:1})):k("",!0),(!e(t).task||e(t).task.uuid!="new")&&!e(t).notification?(r(),D(oe,{key:2,"add-item":e(o).createTask},null,8,["add-item"])):k("",!0)]))}}),at=[{path:"/tasks",name:"list",component:R},{path:"/tasks/:uuid",name:"edit",component:R,props:!0}],G=ae({history:ie(),routes:at});document.getElementById("tasks-app")&&Y(R).use(le).use(re()).use(G).mount("#tasks-app")});export default it();
