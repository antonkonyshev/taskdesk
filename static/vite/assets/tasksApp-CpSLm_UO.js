var K=(n,s)=>()=>(s||n((s={exports:{}}).exports,s),s.exports);var b=(n,s,t)=>new Promise((a,o)=>{var l=y=>{try{_(t.next(y))}catch(w){o(w)}},d=y=>{try{_(t.throw(y))}catch(w){o(w)}},_=y=>y.done?a(y.value):Promise.resolve(y.value).then(l,d);_((t=t.apply(n,s)).next())});import{w as O,z as F,A as M,B as R,y as E,C as h,D as c,F as u,G as S,H as k,I as f,J as e,K as L,L as I,M as m,O as T,P as U,Q as j,v as G}from"../index-Cms_OnbX.js";import{c as Q,p as q,d as V,f as X,r as Y,u as $,m as z,_ as Z,i as ee,a as te}from"../AddButton.vue_vue_type_script_setup_true_lang-LdOomsQP.js";var Ye=K(v=>{let A=null;const ne=(n,s)=>b(v,null,function*(){return yield N().refreshTask(JSON.parse(s.data))}),P=n=>b(v,null,function*(){return A=yield q(A,"/task/"+n+"/",ne),A}),H=()=>Q(A),se=(n,s)=>new Promise((t,a)=>b(v,null,function*(){try{const o={method:s};s=="post"&&(o.body=JSON.stringify({uuid:n,done:!0}),o.headers={"Content-Type":"application/json"});const l=yield fetch(window.API_BASE_URL+"/task/"+n+"/",o);l.ok?t():a(l.status)}catch(o){a(o)}})),oe=n=>new Promise((s,t)=>b(v,null,function*(){try{(yield P(n.uuid)).send(JSON.stringify(n)),s()}catch(a){t(a)}})),ae=n=>b(v,null,function*(){return new Promise((s,t)=>b(v,null,function*(){try{n.uuid&&n.annotate&&(yield P(n.uuid)).send(JSON.stringify(n)),s()}catch(a){t(a)}}))}),ie=n=>b(v,null,function*(){return new Promise((s,t)=>b(v,null,function*(){try{n.uuid&&n.denotate&&(yield P(n.uuid)).send(JSON.stringify(n)),s()}catch(a){t(a)}}))}),N=V("tasks",()=>{const n=O([]),s=x(),{width:t}=F(),a=()=>"/task/",o=p=>Y(p,n,i=>p.uuid==i.uuid,!0),l=()=>b(v,null,function*(){return(yield X(a())).forEach(o)});function d(){const p={id:0,uuid:"new",description:"",urgency:100,project:"",tags:[],entry:null,depends:[],blocks:!1,status:"new",annotations:[]};n.value.unshift(p),s.select(p)}function _(p){return b(this,null,function*(){let i=n.value.findIndex(r=>r.uuid==p.uuid);if(i<0&&(i=n.value.findIndex(r=>r.uuid=="new")),i<0)n.value.unshift(p);else{for(const r in p){const g=r;n.value[i][g]=p[g]}s.task&&s.task.uuid==n.value[i].uuid&&(yield H())}})}function y(p){for(const i of n.value)if(i.depending&&i.depends.length){const r=i.depends.indexOf(p.uuid);r>=0&&(i.depending=null,i.depends.splice(r,1))}for(const i of p.depends){const r=n.value.find(g=>g.uuid==i);r&&(r.blocking=null)}}function w(p){return b(this,null,function*(){const i=n.value.findIndex(r=>r.uuid==p.uuid);i>=0&&n.value.splice(i,1),s.excludeFromHistory(p),n.value.length&&t.value>=800&&s.select(n.value[0]),y(p)})}function B(p){for(const i of n.value)if(i.depends.indexOf(p.uuid)>=0)return p.blocking=!0,!0;return p.blocking=!1,!1}function D(p){for(const i of p.depends)if(n.value.findIndex(r=>r.uuid==i)>=0)return p.depending=!0,!0;return p.depending=!1,!1}return{tasks:n,loadTasks:l,removeTask:w,createTask:d,refreshTask:_,isTaskBlocking:B,isTaskDepending:D}}),x=V("task",()=>{const n=O(null),s=N(),t=M(n,{capacity:64});function a(i){n.value=i}const o=R(()=>{const i=new Set([]);for(const r of n.value.depends){const g=s.tasks.find(C=>C.uuid==r);g&&i.add(g)}return i}),l=R(()=>{const i=new Set([]);if(n.value&&n.value.blocks!==!1)for(const r of s.tasks)r.depends&&r.depends.length&&r.depends.indexOf(n.value.uuid)>=0&&i.add(r);return i});function d(i){return b(this,null,function*(){const r=i.target,g=r.value.trim();if(n.value&&n.value.uuid&&r.name in n.value&&n.value[r.name]!=g&&(r.name!="description"||g)){const C={uuid:n.value.uuid};C[r.name]=g,yield oe(C),n.value[r.name]=g}})}let _=0;function y(i){_&&(clearTimeout(_),_=0),i.target==document.activeElement?_=setTimeout(d,3e3,i):d(i)}function w(i){return b(this,null,function*(){n.value&&n.value.uuid&&(yield se(n.value.uuid,i),yield s.removeTask(n.value))})}function B(i){return b(this,null,function*(){const r=i.target;if(r.name=="annotate"){const g=r.value.trim();n.value&&n.value.uuid&&g&&(yield ae({uuid:n.value.uuid,annotate:g}),n.value.annotations.unshift({entry:new Date,description:g}))}})}function D(i){return b(this,null,function*(){i&&n.value&&n.value.uuid&&(yield ie({uuid:n.value.uuid,denotate:i}),n.value.annotations=n.value.annotations.filter(r=>r.description.indexOf(i)<0))})}function p(i){for(const r of["history","undoStack","redoStack"]){let g=t[r].value.findIndex(C=>C.snapshot&&C.snapshot.uuid==i.uuid);i.id==2&&g>=0&&g>=0&&t[r].value.splice(g,1)}}return E(n,(i,r)=>b(v,null,function*(){r&&r.uuid=="new"&&s.removeTask(r),(!i||!r||r.uuid!=i.uuid)&&(yield H())})),{task:n,history:t,depends:o,blocks:l,select:a,editing:y,update:w,annotate:B,denotate:D,excludeFromHistory:p}}),W=h({__name:"StateLabels",props:{task:{},labelClass:{},commonLabelClass:{},criticalLabelClass:{},shortenLabels:{},allowRowArrangement:{}},setup(n){const{t:s}=$(),{width:t}=F(),a=N();return(o,l)=>(u(),c("span",{class:S(["flex flex-col",{"flex-row xl:flex-col":o.allowRowArrangement}])},[o.task.wait?(u(),c("span",{key:0,class:S([o.labelClass+" "+o.commonLabelClass,"task-label"])},f(o.shortenLabels&&e(t)<+o.shortenLabels?e(s)("message.delayed"):e(s)("message.delayed_task")),3)):k("",!0),o.task.depending===!0||e(a).isTaskDepending(o.task)?(u(),c("span",{key:1,class:S([o.labelClass+" "+o.commonLabelClass,"task-label"])},f(o.shortenLabels&&e(t)<+o.shortenLabels?e(s)("message.blocked"):e(s)("message.blocked_task")),3)):k("",!0),o.task.blocking===!0||e(a).isTaskBlocking(o.task)?(u(),c("span",{key:2,class:S([o.labelClass+" "+o.criticalLabelClass,"task-label"])},f(o.shortenLabels&&e(t)<+o.shortenLabels?e(s)("message.blocking"):e(s)("message.blocking_tasks")),3)):k("",!0)],2))}}),le={class:"flex-1 overflow-y-scroll scroll-smooth overflow-x-clip [overflow-clip-margin:10px] max-h-[calc(100vh_+_0.75rem)] md:-ml-6 md:pl-6"},re=["onClick"],ue={class:"font-semibold flex flex-row justify-between items-start gap-2"},ce=["textContent"],de={key:0,class:"flex flex-row flex-wrap gap-2 py-1"},pe=["textContent"],ke=["textContent"],fe={key:1,class:"flex flex-row gap-1 items-center"},ge=["textContent"],me=["textContent"],be=h({__name:"TasksList",setup(n){const{t:s}=$(),t=x(),a=N();return(o,l)=>(u(),c("div",le,[(u(!0),c(L,null,I(e(a).tasks,d=>(u(),c("div",{key:d.uuid,onClick:_=>e(t).select(d),class:S([{"!shadow-lg !scale-[102%]":e(t).task&&d.uuid===e(t).task.uuid},"my-3 p-3 md:mx-4 shadow-black shadow-xs bg-white hover:shadow-md hover:scale-[101%] dark:bg-gray-800 dark:text-white duration-200 cursor-pointer wrap-break-word"])},[m("h2",ue,[m("span",{textContent:f(d.description),class:S(["text-lg flex-1",{"text-gray-600":d.depending===!0||e(a).isTaskDepending(d)||d.wait}])},null,10,ce),T(W,{task:d,class:"gap-1","label-class":"text-xs","common-label-class":"bg-gray-200 dark:bg-gray-700","critical-label-class":"bg-red-700 text-white","shorten-labels":"400"},null,8,["task"])]),d.tags?(u(),c("ul",de,[(u(!0),c(L,null,I(d.tags,_=>(u(),c("li",{textContent:f(_),class:"bg-gray-200 dark:bg-gray-700 text-xs task-label"},null,8,pe))),256)),!d.due&&d.project?(u(),c("li",{key:0,textContent:f(d.project),class:"bg-gray-200 text-xs task-label ml-auto"},null,8,ke)):k("",!0)])):k("",!0),d.due?(u(),c("p",fe,[m("span",{textContent:f(d.due?e(s)("message.due_date")+" "+e(z)(d.due).fromNow():""),class:"flex-1"},null,8,ge),d.project?(u(),c("span",{key:0,textContent:f(d.project),class:"bg-gray-200 dark:bg-gray-700 text-xs task-label !pb-1"},null,8,me)):k("",!0)])):k("",!0)],10,re))),128))]))}}),_e={class:"flex flex-row flex-nowrap gap-3"},ye=h({__name:"Actions",setup(n){const s=x();return(t,a)=>(u(),c("aside",_e,[e(s).history.canUndo?(u(),c("button",{key:0,type:"button",onClick:a[0]||(a[0]=o=>e(s).history.undo()),class:"action-button hover:bg-gray-300"},a[4]||(a[4]=[m("span",{class:"inline-block size-6 bg-no-repeat bg-center bg-contain svg-arrow-left dark:invert-100 dark:hover:invert-0"},null,-1)]))):k("",!0),e(s).history.canRedo?(u(),c("button",{key:1,type:"button",onClick:a[1]||(a[1]=o=>e(s).history.redo()),class:"action-button hover:bg-gray-300"},a[5]||(a[5]=[m("span",{class:"inline-block size-6 bg-no-repeat bg-center bg-contain svg-arrow-right dark:invert-100 dark:hover:invert-0"},null,-1)]))):k("",!0),e(s).task.uuid!="new"?(u(),c("button",{key:2,type:"button",onClick:a[2]||(a[2]=o=>e(s).update("delete")),class:"action-button hover:bg-red-700 hover:!border-red-700 group ml-auto"},a[6]||(a[6]=[m("span",{class:"inline-block size-6 bg-no-repeat bg-center bg-contain svg-trash dark:invert-100 group-hover:invert-100"},null,-1)]))):k("",!0),e(s).task.uuid!="new"?(u(),c("button",{key:3,type:"button",onClick:a[3]||(a[3]=o=>e(s).update("post")),class:"action-button hover:bg-green-700 hover:!border-green-700 group"},a[7]||(a[7]=[m("span",{class:"inline-block size-6 bg-no-repeat bg-center bg-contain svg-check dark:invert-100 group-hover:invert-100"},null,-1)]))):k("",!0)]))}}),ve={key:0},he=["textContent"],xe=["textContent","onClick"],we=h({__name:"Dependencies",setup(n){const{t:s}=$(),t=x();return(a,o)=>e(t).depends.size?(u(),c("p",ve,[m("span",{textContent:f(e(s)("message.this_task_depends_on_the_following_tasks")+":"),class:"font-semibold"},null,8,he),(u(!0),c(L,null,I(e(t).depends,l=>(u(),c("a",{href:"#",textContent:f(l.description),onClick:d=>e(t).select(l),class:"block underline hover:text-green-700 hover:no-underline duration-200 py-0.5"},null,8,xe))),256))])):k("",!0)}}),Ce={key:0},$e=["textContent"],Te=["textContent","onClick"],Se=h({__name:"BlockedTasks",setup(n){const{t:s}=$(),t=x();return(a,o)=>e(t).blocks.size?(u(),c("p",Ce,[m("span",{textContent:f(e(s)("message.this_task_blocks_the_following_tasks")+":"),class:"font-semibold"},null,8,$e),(u(!0),c(L,null,I(e(t).blocks,l=>(u(),c("a",{href:"#",textContent:f(l.description),onClick:d=>e(t).select(l),class:"block underline hover:text-green-700 hover:no-underline duration-200 py-0.5"},null,8,Te))),256))])):k("",!0)}}),Le=["textContent"],Ie={class:"flex flex-row pt-1 gap-2 items-center"},ze=["textContent"],Ne=["textContent"],je=["onClick"],Ae=["textContent"],Be=["placeholder"],De=h({__name:"Annotations",setup(n){const{t:s}=$(),t=x(),a=O(!1);return(o,l)=>(u(),c("p",null,[m("span",{textContent:f(e(s)("message.annotations")),class:"font-semibold"},null,8,Le),(u(!0),c(L,null,I(e(t).task.annotations,d=>(u(),c("span",Ie,[m("span",{textContent:f(d.description),class:"flex-1"},null,8,ze),m("span",{textContent:f(e(z)(d.entry).fromNow())},null,8,Ne),m("button",{type:"button",onClick:_=>e(t).denotate(d.description),class:"group cursor-pointer action-button !px-1 !py-0.5 mt-0.5 !rounded-md hover:bg-red-700 hover:!border-red-700 duration-200"},l[3]||(l[3]=[m("span",{class:"inline-block size-4 bg-no-repeat bg-center bg-contain svg-trash dark:invert-100 group-hover:invert-100"},null,-1)]),8,je)]))),256)),a.value?k("",!0):(u(),c("button",{key:0,type:"button",onClick:l[0]||(l[0]=d=>a.value=!0),class:"flex flex-row items-center gap-1 mt-1 hover:underline cursor-pointer"},[l[4]||(l[4]=m("span",{class:"inline-block size-5 bg-no-repeat bg-center bg-contain svg-plus-circle dark:invert-100 mt-0.5"},null,-1)),m("span",{textContent:f(e(s)("message.add_annotation"))},null,8,Ae)])),a.value?(u(),c("input",{key:1,type:"text",placeholder:e(s)("message.enter_annotation_description"),name:"annotate",class:"w-full mt-1",onFocusout:l[1]||(l[1]=d=>{e(t).annotate(d),a.value=!1}),onKeypress:l[2]||(l[2]=U(d=>{e(t).annotate(d),a.value=!1},["enter"]))},null,40,Be)):k("",!0)]))}}),Oe={key:0,class:"flex flex-col items-start"},Fe={key:0,class:"flex flex-col items-start justify-between w-full lg:flex-row lg:items-center"},Pe={key:0},Re={key:1},Je={key:1},Ee=h({__name:"DatesDetails",setup(n){const{t:s}=$(),t=x();return(a,o)=>e(t).task.entry||e(t).task.due||e(t).task.wait?(u(),c("p",Oe,[e(t).task.entry||e(t).task.due?(u(),c("span",Fe,[e(t).task.due?(u(),c("span",Pe,f(e(s)("message.due_date"))+" "+f(e(z)(e(t).task.due).fromNow()),1)):k("",!0),e(t).task.entry?(u(),c("span",Re,f(e(s)("message.created"))+" "+f(e(z)(e(t).task.entry).fromNow()),1)):k("",!0)])):k("",!0),e(t).task.wait?(u(),c("span",Je,f(e(s)("message.will_become_active"))+" "+f(e(z)(e(t).task.wait).fromNow()),1)):k("",!0)])):k("",!0)}}),Ve={class:"flex-1 lg:flex-2 my-3 mx-3 md:!ml-0 px-4 py-3.5 bg-white min-h-screen shadow-[0px_0px_5px_-2px_#000] dark:bg-gray-800 dark:text-white"},He={class:"font-semibold text-2xl flex flex-col xl:flex-row gap-2 items-start xl:items-center pt-4 pb-3"},We=["placeholder","value"],Ke={key:0,class:"flex flex-row items-center gap-2"},Me=["textContent"],Ue=["placeholder","value"],Ge=["textContent"],Qe=h({__name:"TaskDetails",setup(n){const{t:s}=$(),t=x();return(a,o)=>(u(),c("div",Ve,[T(ye),m("h2",He,[m("input",{type:"text",class:"flex-1 w-full outline-none focus-visible:!outline-none",name:"description",id:"id_description",onFocusout:o[0]||(o[0]=(...l)=>e(t).editing&&e(t).editing(...l)),onFocusin:o[1]||(o[1]=(...l)=>e(t).editing&&e(t).editing(...l)),onInput:o[2]||(o[2]=(...l)=>e(t).editing&&e(t).editing(...l)),placeholder:e(s)("message.enter_task_description"),value:e(t).task.description},null,40,We),T(W,{task:e(t).task,class:"gap-2","label-class":"text-lg","common-label-class":"bg-gray-200 dark:bg-gray-700","critical-label-class":"bg-red-200 dark:text-black","allow-row-arrangement":"true"},null,8,["task"])]),e(t).task.uuid!="new"?(u(),c("p",Ke,[m("span",{textContent:f(e(s)("message.project")+":")},null,8,Me),m("input",{type:"text",class:"flex-1 outline-none focus-visible:!outline-none",name:"project",placeholder:e(s)("message.not_specified").toLowerCase(),onFocusout:o[3]||(o[3]=(...l)=>e(t).editing&&e(t).editing(...l)),onFocusin:o[4]||(o[4]=(...l)=>e(t).editing&&e(t).editing(...l)),onInput:o[5]||(o[5]=(...l)=>e(t).editing&&e(t).editing(...l)),value:e(t).task.project},null,40,Ue),e(t).task.tags?(u(!0),c(L,{key:0},I(e(t).task.tags,l=>(u(),c("span",{textContent:f(l),class:"bg-gray-200 task-label !pt-0 dark:bg-gray-700"},null,8,Ge))),256)):k("",!0)])):k("",!0),T(Ee),T(we,{class:"pt-4"}),T(Se,{class:"pt-4"}),e(t).task.uuid!="new"?(u(),j(De,{key:1,class:"pt-4"})):k("",!0)]))}}),qe={class:"flex flex-row"},J=768,Xe=h({__name:"TasksApp",setup(n){const s=x(),t=N(),{width:a}=F();function o(){a.value>=J&&!s.task&&t.tasks.length&&s.select(t.tasks[0])}E(a,o);function l(){return b(this,null,function*(){yield t.loadTasks(),o()})}return l(),(d,_)=>(u(),c("div",qe,[(!e(s).task||e(a)>=J)&&e(t).tasks.length?(u(),j(be,{key:0})):k("",!0),e(s).task?(u(),j(Qe,{key:1})):k("",!0),!e(s).task||e(s).task.uuid!="new"?(u(),j(Z,{key:2,"add-item":e(t).createTask},null,8,["add-item"])):k("",!0)]))}});document.getElementById("tasks-app")&&G(Xe).use(ee).use(te()).mount("#tasks-app")});export default Ye();
