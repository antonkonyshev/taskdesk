var Q=(s,n)=>()=>(n||s((n={exports:{}}).exports,n),n.exports);var _=(s,n,t)=>new Promise((o,i)=>{var c=x=>{try{f(t.next(x))}catch(T){i(T)}},a=x=>{try{f(t.throw(x))}catch(T){i(T)}},f=x=>x.done?o(x.value):Promise.resolve(x.value).then(c,a);f((t=t.apply(s,n)).next())});import{x as B,A as P,B as U,C as E,z as H,D as h,F as $,G as u,H as r,I,J as p,K as g,L as e,M as j,O as z,P as b,Q as L,R as q,S as X,T as D,U as Y,V as Z,v as ee,w as te}from"../InstallAppButton.vue_vue_type_script_setup_true_lang-hm-W6wS2.js";import{d as W,f as se,r as ne,c as oe,p as ae,m as A,u as ie,_ as le,a as re,b as ue,e as ce}from"../moment-with-locales-Cjs9biKm.js";var pt=Q(y=>{const N=W("tasks",()=>{const s=B([]),n=w(),{width:t}=P(),o=()=>"/task/",i=k=>ne(k,s,m=>k.uuid==m.uuid,!0),c=()=>_(y,null,function*(){return(yield se(o())).forEach(i)});function a(){const k={id:0,uuid:"new",description:"",urgency:100,project:"",tags:[],entry:null,depends:[],blocks:!1,status:"new",annotations:[]};s.value.unshift(k),n.select(k)}function f(k){return _(this,null,function*(){let m=s.value.findIndex(l=>l.uuid==k.uuid);if(m<0&&(m=s.value.findIndex(l=>l.uuid=="new")),m<0)s.value.unshift(k);else for(const l in k){const d=l;s.value[m][d]=k[d]}})}function x(k){for(const m of s.value)if(m.depending&&m.depends.length){const l=m.depends.indexOf(k.uuid);l>=0&&(m.depending=null,m.depends.splice(l,1))}for(const m of k.depends){const l=s.value.find(d=>d.uuid==m);l&&(l.blocking=null)}}function T(k){return _(this,null,function*(){const m=s.value.findIndex(l=>l.uuid==k.uuid);m>=0&&s.value.splice(m,1),n.excludeFromHistory(k),s.value.length&&t.value>=800&&n.select(s.value[0]),x(k)})}function O(k){for(const m of s.value)if(m.depends.indexOf(k.uuid)>=0)return k.blocking=!0,!0;return k.blocking=!1,!1}function F(k){for(const m of k.depends)if(s.value.findIndex(l=>l.uuid==m)>=0)return k.depending=!0,!0;return k.depending=!1,!1}return{tasks:s,loadTasks:c,removeTask:T,createTask:a,refreshTask:f,isTaskBlocking:O,isTaskDepending:F}});let C=null;const de=(s,n)=>_(y,null,function*(){return yield N().refreshTask(JSON.parse(n.data))}),J=s=>_(y,null,function*(){const n="/task/"+s+"/";return C&&!(C.ws.value&&C.ws.value.url==n)&&(yield M(),C=null),C=yield ae(C,n,de),C}),M=()=>oe(C),pe=(s,n)=>new Promise((t,o)=>_(y,null,function*(){try{const i={method:n};n=="post"&&(i.body=JSON.stringify({uuid:s,done:!0}),i.headers={"Content-Type":"application/json"});const c=yield fetch(window.API_BASE_URL+"/task/"+s+"/",i);c.ok?t():o(c.status)}catch(i){o(i)}})),fe=s=>new Promise((n,t)=>_(y,null,function*(){try{(yield J(s.uuid)).send(JSON.stringify(s)),n()}catch(o){t(o)}})),ke=s=>_(y,null,function*(){return new Promise((n,t)=>_(y,null,function*(){try{s.uuid&&s.annotate&&(yield J(s.uuid)).send(JSON.stringify(s)),n()}catch(o){t(o)}}))}),ge=s=>_(y,null,function*(){return new Promise((n,t)=>_(y,null,function*(){try{s.uuid&&s.denotate&&(yield J(s.uuid)).send(JSON.stringify(s)),n()}catch(o){t(o)}}))}),w=W("task",()=>{const s=B(null),n=B(""),t=N(),o=U(s,{capacity:64});function i(l){G.push(l?{name:"edit",params:{uuid:l.uuid}}:{name:"list"}),s.value=l}const c=E(()=>{const l=new Set([]);for(const d of s.value.depends){const v=t.tasks.find(S=>S.uuid==d);v&&l.add(v)}return l}),a=E(()=>{const l=new Set([]);if(s.value&&s.value.blocks!==!1)for(const d of t.tasks)d.depends&&d.depends.length&&d.depends.indexOf(s.value.uuid)>=0&&l.add(d);return l});function f(l){return _(this,null,function*(){const d=l.target,v=d.value.trim();if(s.value&&s.value.uuid&&d.name in s.value&&s.value[d.name]!=v&&(d.name!="description"||v)){const S={uuid:s.value.uuid};S[d.name]=v,yield fe(S),s.value[d.name]=v}})}let x=0;function T(l){x&&(clearTimeout(x),x=0),l.target==document.activeElement?x=setTimeout(f,3e3,l):f(l)}function O(l){return _(this,null,function*(){s.value&&s.value.uuid&&(yield pe(s.value.uuid,l),yield t.removeTask(s.value),i(null))})}function F(l){return _(this,null,function*(){const d=l.target;if(d.name=="annotate"){const v=d.value.trim();s.value&&s.value.uuid&&v&&(yield ke({uuid:s.value.uuid,annotate:v}),s.value.annotations.unshift({entry:new Date,description:v}))}})}function k(l){return _(this,null,function*(){l&&s.value&&s.value.uuid&&(yield ge({uuid:s.value.uuid,denotate:l}),s.value.annotations=s.value.annotations.filter(d=>d.description.indexOf(l)<0))})}function m(l){for(const d of["history","undoStack","redoStack"]){let v=o[d].value.findIndex(S=>S.snapshot&&S.snapshot.uuid==l.uuid);l.id==2&&v>=0&&v>=0&&o[d].value.splice(v,1)}}return H(s,(l,d)=>_(y,null,function*(){d&&d.uuid=="new"&&t.removeTask(d),(!l||!d||d.uuid!=l.uuid)&&(yield M())})),H(()=>s.value&&s.value.uuid,(l,d)=>{d!="new"||!l||l&&l!="new"&&(n.value="message.task_created",setTimeout(()=>n.value="",2e3))}),{task:s,history:o,depends:c,blocks:a,select:i,editing:T,update:O,annotate:F,denotate:k,excludeFromHistory:m,notification:n}}),K=h({__name:"StateLabels",props:{task:{},labelClass:{},commonLabelClass:{},criticalLabelClass:{},shortenLabels:{},allowRowArrangement:{}},setup(s){const{t:n}=$(),{width:t}=P(),o=N();return(i,c)=>(r(),u("span",{class:I(["flex flex-col",{"flex-row xl:flex-col":i.allowRowArrangement}])},[i.task.wait?(r(),u("span",{key:0,class:I([i.labelClass+" "+i.commonLabelClass,"task-label"])},g(i.shortenLabels&&e(t)<+i.shortenLabels?e(n)("message.delayed"):e(n)("message.delayed_task")),3)):p("",!0),i.task.depending===!0||e(o).isTaskDepending(i.task)?(r(),u("span",{key:1,class:I([i.labelClass+" "+i.commonLabelClass,"task-label"])},g(i.shortenLabels&&e(t)<+i.shortenLabels?e(n)("message.blocked"):e(n)("message.blocked_task")),3)):p("",!0),i.task.blocking===!0||e(o).isTaskBlocking(i.task)?(r(),u("span",{key:2,class:I([i.labelClass+" "+i.criticalLabelClass,"task-label"])},g(i.shortenLabels&&e(t)<+i.shortenLabels?e(n)("message.blocking"):e(n)("message.blocking_tasks")),3)):p("",!0)],2))}}),me={class:"flex-1 overflow-y-scroll scroll-smooth overflow-x-clip [overflow-clip-margin:10px] max-h-[calc(100vh_+_0.75rem)] md:-ml-6 md:pl-6"},be=["onClick"],_e={class:"font-semibold flex flex-row justify-between items-start gap-2"},ve=["textContent"],xe={key:0,class:"flex flex-row flex-wrap gap-2 py-1"},ye=["textContent"],he=["textContent"],we={key:1,class:"flex flex-row gap-1 items-center justify-end"},Ce=["textContent"],$e=["textContent"],Te=h({__name:"TasksList",setup(s){const{t:n}=$(),t=w(),o=N();return(i,c)=>(r(),u("div",me,[(r(!0),u(j,null,z(e(o).tasks,a=>(r(),u("div",{key:a.uuid,onClick:f=>e(t).select(a),class:I([{"!shadow-lg !scale-[102%]":e(t).task&&a.uuid===e(t).task.uuid},"my-3 p-3 md:mx-4 shadow-black shadow-xs bg-white hover:shadow-md hover:scale-[101%] dark:bg-gray-800 dark:text-white duration-200 cursor-pointer wrap-break-word"])},[b("h2",_e,[b("span",{textContent:g(a.description),class:I(["text-lg flex-1",{"text-gray-600":a.depending===!0||e(o).isTaskDepending(a)||a.wait}])},null,10,ve),L(K,{task:a,class:"gap-1","label-class":"text-xs","common-label-class":"bg-gray-200 dark:bg-gray-700","critical-label-class":"bg-red-700 text-white","shorten-labels":"400"},null,8,["task"])]),a.tags?(r(),u("ul",xe,[(r(!0),u(j,null,z(a.tags,f=>(r(),u("li",{textContent:g(f),class:"bg-gray-200 dark:bg-gray-700 text-xs task-label"},null,8,ye))),256)),!a.due&&a.project?(r(),u("li",{key:0,textContent:g(a.project),class:"bg-gray-200 text-xs task-label ml-auto"},null,8,he)):p("",!0)])):p("",!0),a.due||a.project?(r(),u("p",we,[a.due?(r(),u("span",{key:0,textContent:g(a.due?e(n)("message.due_date")+" "+e(A)(a.due).fromNow():""),class:"flex-1"},null,8,Ce)):p("",!0),a.project?(r(),u("span",{key:1,textContent:g(a.project),class:"bg-gray-200 dark:bg-gray-700 text-xs task-label !pb-1"},null,8,$e)):p("",!0)])):p("",!0)],10,be))),128))]))}}),Se={class:"flex flex-row flex-nowrap gap-3"},Le=h({__name:"Actions",setup(s){const n=w();return(t,o)=>(r(),u("aside",Se,[e(n).history.canUndo?(r(),u("button",{key:0,type:"button",onClick:o[0]||(o[0]=i=>e(n).history.undo()),class:"action-button hover:bg-gray-300"},o[4]||(o[4]=[b("span",{class:"inline-block size-6 bg-no-repeat bg-center bg-contain svg-arrow-left dark:invert-100 dark:hover:invert-0"},null,-1)]))):p("",!0),e(n).history.canRedo?(r(),u("button",{key:1,type:"button",onClick:o[1]||(o[1]=i=>e(n).history.redo()),class:"action-button hover:bg-gray-300"},o[5]||(o[5]=[b("span",{class:"inline-block size-6 bg-no-repeat bg-center bg-contain svg-arrow-right dark:invert-100 dark:hover:invert-0"},null,-1)]))):p("",!0),e(n).task.uuid!="new"?(r(),u("button",{key:2,type:"button",onClick:o[2]||(o[2]=i=>e(n).update("delete")),class:"action-button hover:bg-red-700 hover:!border-red-700 group ml-auto"},o[6]||(o[6]=[b("span",{class:"inline-block size-6 bg-no-repeat bg-center bg-contain svg-trash dark:invert-100 group-hover:invert-100"},null,-1)]))):p("",!0),e(n).task.uuid!="new"?(r(),u("button",{key:3,type:"button",onClick:o[3]||(o[3]=i=>e(n).update("post")),class:"action-button hover:bg-green-700 hover:!border-green-700 group"},o[7]||(o[7]=[b("span",{class:"inline-block size-6 bg-no-repeat bg-center bg-contain svg-check dark:invert-100 group-hover:invert-100"},null,-1)]))):p("",!0)]))}}),Ie={key:0},je=["textContent"],ze=["textContent","onClick"],Ne=h({__name:"Dependencies",setup(s){const{t:n}=$(),t=w();return(o,i)=>e(t).depends.size?(r(),u("p",Ie,[b("span",{textContent:g(e(n)("message.this_task_depends_on_the_following_tasks")+":"),class:"font-semibold"},null,8,je),(r(!0),u(j,null,z(e(t).depends,c=>(r(),u("a",{href:"#",textContent:g(c.description),onClick:a=>e(t).select(c),class:"block underline hover:text-green-700 hover:no-underline duration-200 py-0.5"},null,8,ze))),256))])):p("",!0)}}),Ae={key:0},Be=["textContent"],De=["textContent","onClick"],Oe=h({__name:"BlockedTasks",setup(s){const{t:n}=$(),t=w();return(o,i)=>e(t).blocks.size?(r(),u("p",Ae,[b("span",{textContent:g(e(n)("message.this_task_blocks_the_following_tasks")+":"),class:"font-semibold"},null,8,Be),(r(!0),u(j,null,z(e(t).blocks,c=>(r(),u("a",{href:"#",textContent:g(c.description),onClick:a=>e(t).select(c),class:"block underline hover:text-green-700 hover:no-underline duration-200 py-0.5"},null,8,De))),256))])):p("",!0)}}),Fe=["textContent"],Re={class:"flex flex-row pt-1 gap-2 items-center"},Pe=["textContent"],Je=["textContent"],Ee=["onClick"],He=["textContent"],Ve=["placeholder"],We=h({__name:"Annotations",setup(s){const{t:n}=$(),t=w(),o=B(!1);return(i,c)=>(r(),u("p",null,[b("span",{textContent:g(e(n)("message.annotations")),class:"font-semibold"},null,8,Fe),(r(!0),u(j,null,z(e(t).task.annotations,a=>(r(),u("span",Re,[b("span",{textContent:g(a.description),class:"flex-1"},null,8,Pe),b("span",{textContent:g(e(A)(a.entry).fromNow())},null,8,Je),b("button",{type:"button",onClick:f=>e(t).denotate(a.description),class:"group cursor-pointer action-button !px-1 !py-0.5 mt-0.5 !rounded-md hover:bg-red-700 hover:!border-red-700 duration-200"},c[3]||(c[3]=[b("span",{class:"inline-block size-4 bg-no-repeat bg-center bg-contain svg-trash dark:invert-100 group-hover:invert-100"},null,-1)]),8,Ee)]))),256)),o.value?p("",!0):(r(),u("button",{key:0,type:"button",onClick:c[0]||(c[0]=a=>o.value=!0),class:"flex flex-row items-center gap-1 mt-1 hover:underline cursor-pointer"},[c[4]||(c[4]=b("span",{class:"inline-block size-5 bg-no-repeat bg-center bg-contain svg-plus-circle dark:invert-100 mt-0.5"},null,-1)),b("span",{textContent:g(e(n)("message.add_annotation"))},null,8,He)])),o.value?(r(),u("input",{key:1,type:"text",placeholder:e(n)("message.enter_annotation_description"),name:"annotate",class:"w-full mt-1",onFocusout:c[1]||(c[1]=a=>{e(t).annotate(a),o.value=!1}),onKeypress:c[2]||(c[2]=q(a=>{e(t).annotate(a),o.value=!1},["enter"]))},null,40,Ve)):p("",!0)]))}}),Me={key:0,class:"flex flex-col items-start"},Ke={key:0,class:"flex flex-col items-start justify-between w-full lg:flex-row lg:items-center"},Ge={key:0},Qe={key:1},Ue={key:1},qe=h({__name:"DatesDetails",setup(s){const{t:n}=$(),t=w();return(o,i)=>e(t).task.entry||e(t).task.due||e(t).task.wait?(r(),u("p",Me,[e(t).task.entry||e(t).task.due?(r(),u("span",Ke,[e(t).task.due?(r(),u("span",Ge,g(e(n)("message.due_date"))+" "+g(e(A)(e(t).task.due).fromNow()),1)):p("",!0),e(t).task.entry?(r(),u("span",Qe,g(e(n)("message.created"))+" "+g(e(A)(e(t).task.entry).fromNow()),1)):p("",!0)])):p("",!0),e(t).task.wait?(r(),u("span",Ue,g(e(n)("message.will_become_active"))+" "+g(e(A)(e(t).task.wait).fromNow()),1)):p("",!0)])):p("",!0)}}),Xe={class:"flex-1 relative lg:flex-2 my-3 mx-3 md:!ml-0 px-4 py-3.5 bg-white min-h-screen shadow-[0px_0px_5px_-2px_#000] dark:bg-gray-800 dark:text-white"},Ye={class:"font-semibold text-2xl flex flex-col xl:flex-row gap-2 items-start xl:items-center pt-4 pb-3"},Ze=["placeholder","value"],et={key:0,class:"flex flex-row items-center gap-2"},tt=["textContent"],st=["placeholder","value"],nt=["textContent"],ot=["textContent"],at=h({__name:"TaskDetails",setup(s){const{t:n}=$(),t=w(),o=B(null);X(()=>{o.value&&!o.value.value&&o.value.focus()});const i=c=>{c.target.value=c.target.value.toLowerCase(),t.editing(c)};return(c,a)=>(r(),u("div",Xe,[L(Le),b("h2",Ye,[b("textarea",{class:"flex-1 w-full outline-none focus-visible:!outline-none",type:"text",name:"description",ref_key:"descriptionInput",ref:o,id:"id_description",onFocusout:a[0]||(a[0]=(...f)=>e(t).editing&&e(t).editing(...f)),onFocusin:a[1]||(a[1]=(...f)=>e(t).editing&&e(t).editing(...f)),onInput:a[2]||(a[2]=(...f)=>e(t).editing&&e(t).editing(...f)),placeholder:e(n)("message.enter_task_description"),value:e(t).task.description},null,40,Ze),L(K,{task:e(t).task,class:"gap-2","label-class":"text-lg","common-label-class":"bg-gray-200 dark:bg-gray-700","critical-label-class":"bg-red-200 dark:text-black","allow-row-arrangement":"true"},null,8,["task"])]),e(t).task.uuid!="new"?(r(),u("p",et,[b("span",{textContent:g(e(n)("message.project")+":")},null,8,tt),b("input",{type:"text",class:"flex-1 outline-none focus-visible:!outline-none",name:"project",placeholder:e(n)("message.not_specified").toLowerCase(),onFocusout:a[3]||(a[3]=(...f)=>e(t).editing&&e(t).editing(...f)),onFocusin:a[4]||(a[4]=(...f)=>e(t).editing&&e(t).editing(...f)),onInput:i,value:e(t).task.project},null,40,st),e(t).task.tags?(r(!0),u(j,{key:0},z(e(t).task.tags,f=>(r(),u("span",{textContent:g(f),class:"bg-gray-200 task-label !pt-0 dark:bg-gray-700"},null,8,nt))),256)):p("",!0)])):p("",!0),L(qe),L(Ne,{class:"pt-4"}),L(Oe,{class:"pt-4"}),e(t).task.uuid!="new"?(r(),D(We,{key:1,class:"pt-4"})):p("",!0),e(t).notification?(r(),u("p",{key:2,class:"fixed z-30 bottom-4 right-4 py-4 px-8 rounded-md text-xl font-semibold border-b border-gray-800 shadow-sm shadow-td-gray-dark bg-td-secondary-light dark:bg-td-primary",textContent:g(e(n)(e(t).notification))},null,8,ot)):p("",!0)]))}}),it={class:"flex flex-row justify-end items-center text-center xs:gap-3 xs:px-3 sm:gap-5 sm:px-5 md:gap-6 md:px-6 border-l-gray-300 border-l",role:"menu"},lt={role:"menuitem"},rt=["textContent"],ut=h({__name:"TasksToolbarActions",setup(s){const{t:n}=$(),t=N();return(o,i)=>(r(),u("ul",it,[b("li",lt,[b("a",{href:"",onClick:i[0]||(i[0]=Y((...c)=>e(t).createTask&&e(t).createTask(...c),["stop","prevent"])),class:"navigation-button flex !flex-col !px-4"},[i[1]||(i[1]=b("span",{class:"navigation-icon !mx-0 svg-plus-circle"},null,-1)),b("span",{class:"text-sm",textContent:g(e(n)("message.add_task"))},null,8,rt)])])]))}}),ct={class:"flex flex-row"},V=768,R=h({__name:"TasksApp",setup(s){const n=ie(),t=w(),o=N(),{width:i}=P();function c(){return _(this,null,function*(){if(yield o.loadTasks(),n.params.uuid=="new")o.createTask();else{let a=-1;n.params.uuid&&(a=o.tasks.findIndex(f=>f.uuid==n.params.uuid)),a<0&&!t.task&&i.value>=V&&o.tasks.length&&(a=0),a>=0&&t.select(o.tasks[a])}})}return c(),(a,f)=>(r(),u("div",ct,[(!e(t).task||e(i)>=V)&&e(o).tasks.length?(r(),D(Te,{key:0})):p("",!0),e(t).task?(r(),D(at,{key:1})):p("",!0),L(le,{"show-add-task":!1},{default:Z(()=>[(!e(t).task||e(t).task.uuid!="new")&&!e(t).notification?(r(),D(ut,{key:0})):p("",!0)]),_:1})]))}}),dt=[{path:"/tasks",name:"list",component:R},{path:"/tasks/:uuid",name:"edit",component:R,props:!0}],G=re({history:ue(),routes:dt});document.getElementById("tasks-app")&&ee(R).use(te).use(ce()).use(G).mount("#tasks-app")});export default pt();
